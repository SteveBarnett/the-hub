var bcrypt = require('bcrypt');

exports.userCheck = function (req, res, next) {
        if (req.session.user){
             next();
        }
        else{
             res.redirect("/")
        }
    };

    exports.userLogin = function(req, res, next) {
        req.getServices()
            .then(function(services){
                var input = JSON.parse(JSON.stringify(req.body));
                var username = input.username;
                var loginDataService = services.loginDataService;
                loginDataService.login(username)
                    .then(function(results){
                        var user = results[0];
                        bcrypt.compare(input.password, user.password,function(err, pass) {
                            if (pass) {
                                req.session.user = username;
                                req.session.role =  user.role;
                                return res.redirect("/home")
                            } else {
                                return res.redirect('/');

                            }
                        });
                    })
            })
            .catch(function(err){
                next(err);
            });
    };

